<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
    <generator uri="https://blog.rust-lang.org/inside-rust/" version="0.1.0">Inside Rust Blog</generator>
    <link href="https://blog.rust-lang.org/inside-rust/feed.xml" rel="self" type="application/atom+xml" />
    <link href="https://blog.rust-lang.org/inside-rust/" rel="alternate" type="text/html" />
    <id>https://blog.rust-lang.org/inside-rust/</id>
    <title>Inside Rust Blog</title>
    <subtitle>Want to follow along with Rust development? Curious how you might get involved? Take a look!</subtitle>
    <author>
        <name>Maintained by the Rust Teams.</name>
        <uri>https://github.com/rust-lang/blog.rust-lang.org/</uri>
    </author>
    <updated>2019-10-24T20:29:23Z</updated>

    
    <entry>
        <title>Please welcome pnkfelix as compiler team co-lead!</title>
        <link rel="alternate" href="https://blog.rust-lang.org/inside-rust/2019/10/24/pnkfelix-compiler-team-co-lead.html" type="text/html" title="Please welcome pnkfelix as compiler team co-lead!" />
        <published>2019-10-24T00:00:00Z</published>
        <updated>2019-10-24T00:00:00Z</updated>
        <id>https://blog.rust-lang.org/inside-rust/2019/10/24/pnkfelix-compiler-team-co-lead.html</id>
        <content type="html" xml:base="https://blog.rust-lang.org/inside-rust/2019/10/24/pnkfelix-compiler-team-co-lead.html">&lt;p&gt;I'm happy to announce that &lt;a href=&quot;https://github.com/pnkfelix&quot;&gt;pnkfelix&lt;/a&gt; will be joining me as compiler
team co-lead. Felix was a &amp;quot;founding member&amp;quot; of the compiler team when
it first started, and was involved with Rust long before that. For the
last year or so, he's been taking over an increasingly large share of
&amp;quot;compiler team leadership&amp;quot;, including running the weekly triage
meeting and generally tending to the quality of the compiler as a
whole. So many thanks to &lt;a href=&quot;https://github.com/pnkfelix&quot;&gt;pnkfelix&lt;/a&gt; for all that he does, and
congratulations! üéâ&lt;/p&gt;
</content>

        <author>
            <name>Niko Matsakis</name>
        </author>
    </entry>
    
    <entry>
        <title>docs.rs outage postmortem</title>
        <link rel="alternate" href="https://blog.rust-lang.org/inside-rust/2019/10/24/docsrs-outage-postmortem.html" type="text/html" title="docs.rs outage postmortem" />
        <published>2019-10-24T00:00:00Z</published>
        <updated>2019-10-24T00:00:00Z</updated>
        <id>https://blog.rust-lang.org/inside-rust/2019/10/24/docsrs-outage-postmortem.html</id>
        <content type="html" xml:base="https://blog.rust-lang.org/inside-rust/2019/10/24/docsrs-outage-postmortem.html">&lt;p&gt;At 2019-10-21 01:38 UTC the docs.rs website went down because no available disk
space was left on the server hosting the application. Crate builds were failing
since 2019-10-20 00:55 UTC due to the same reason.&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#root-cause-of-the-outage&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;root-cause-of-the-outage&quot;&gt;&lt;/a&gt;Root cause of the outage&lt;/h2&gt;
&lt;p&gt;docs.rs needs to store the built documentation on the filesystem before
uploading it to the database, and it does so in the
&lt;code&gt;/opt/docs-rs-prefix/documentations&lt;/code&gt; directory. docs.rs never cleared that
directory though, so over time it started to increase its size until it caused
this outage. Code to periodically purge temporary directories was present, but
it was never configured to purge the one which caused the outage.&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#resolution&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;resolution&quot;&gt;&lt;/a&gt;Resolution&lt;/h2&gt;
&lt;p&gt;As the directory doesn‚Äôt contain any persistent data we cleared it and the web
server was restarted. Once we were confident the situation was resolved all the
crates that failed due to the outage were queued for a rebuild.&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#postmortem&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;postmortem&quot;&gt;&lt;/a&gt;Postmortem&lt;/h2&gt;
&lt;p&gt;The increased disk usage was gradual over weeks, slowly reaching 100% and
causing the outage. While monitoring systems were in place and recorded graphs
of the increase, no alert was configured so nobody noticed the problem. We need
to add alerts when disk usage reaches 90%, so the problem can be investigated
and dealt with on time.&lt;/p&gt;
&lt;p&gt;Crates started to fail to build a day earlier, and close to no builds were
successfully completed since then. We need to setup alerts when most of the
builds are failing: as we don‚Äôt have the necessary metrics at the moment to
reliably alert we'll have to add extra instrumentation as well.&lt;/p&gt;
&lt;p&gt;Our response was slower due to issues with our on-call rotation for the
service. The primary contacts don‚Äôt have the level of access required to
increase the disk space of the instance (the temporary fix that was
investigated at first but discarded after the discovery nobody awake could do
it), and the backup contacts don‚Äôt have any production access or expertise on
docs.rs.&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#timeline-of-events&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;timeline-of-events&quot;&gt;&lt;/a&gt;Timeline of events&lt;/h2&gt;
&lt;p&gt;Unless otherwise noted all events happened on 2019-10-21, and all times are in
UTC.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;2019-10-20 00:55: crate builds started failing due to the low disk space&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;01:38: alerts fired for the docs.rs website being down, &lt;a href=&quot;https://github.com/ashleygwilliams&quot;&gt;ashleygwilliams&lt;/a&gt;
(backup contact) got paged&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;01:39: &lt;a href=&quot;https://github.com/QuietMisdreavus&quot;&gt;QuietMisdreavus&lt;/a&gt; joins into the operations channel&lt;/li&gt;
&lt;li&gt;01:39: &lt;a href=&quot;https://github.com/QuietMisdreavus&quot;&gt;QuietMisdreavus&lt;/a&gt; found the reason for the outage (full root partition)&lt;/li&gt;
&lt;li&gt;01:52: &lt;a href=&quot;https://github.com/ashleygwilliams&quot;&gt;ashleygwilliams&lt;/a&gt; proposed to increase disk space, nobody with
permissions required to so was awake or available though&lt;/li&gt;
&lt;li&gt;01:56: &lt;a href=&quot;https://github.com/ashleygwilliams&quot;&gt;ashleygwilliams&lt;/a&gt; contacts &lt;a href=&quot;https://github.com/Mark-Simulacrum&quot;&gt;Mark-Simulacrum&lt;/a&gt;, who has the access
required to increase disk space&lt;/li&gt;
&lt;li&gt;01:57: &lt;a href=&quot;https://github.com/QuietMisdreavus&quot;&gt;QuietMisdreavus&lt;/a&gt; found the directory taking up all the disk space&lt;/li&gt;
&lt;li&gt;02:00: &lt;a href=&quot;https://github.com/QuietMisdreavus&quot;&gt;QuietMisdreavus&lt;/a&gt; removed the directory taking up all the disk space&lt;/li&gt;
&lt;li&gt;02:03: &lt;a href=&quot;https://github.com/QuietMisdreavus&quot;&gt;QuietMisdreavus&lt;/a&gt; restarted the web server&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;02:06: CDN propagated the changes, docs.rs back online&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;02:06: &lt;a href=&quot;https://github.com/Mark-Simulacrum&quot;&gt;Mark-Simulacrum&lt;/a&gt; joins into the operations channel&lt;/li&gt;
&lt;li&gt;08:19: &lt;a href=&quot;https://github.com/pietroalbini&quot;&gt;pietroalbini&lt;/a&gt; added builds failed during the outage back into the
queue&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;19:27: builds of the crates failed during the outage finished&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;&lt;a href=&quot;#action-items&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;action-items&quot;&gt;&lt;/a&gt;Action items&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Update the docs.rs source code to cleanup the offending directory
automatically.&lt;/li&gt;
&lt;li&gt;Add alerts when the available disk space on a server is below 10%.&lt;/li&gt;
&lt;li&gt;Add alerts when most of the builds are failing.&lt;/li&gt;
&lt;li&gt;Revisit the on-call rotation to make sure everyone on it has the
permissions to either react to the incidents or escalate.&lt;/li&gt;
&lt;/ul&gt;
</content>

        <author>
            <name>Pietro Albini</name>
        </author>
    </entry>
    
    <entry>
        <title>2019-10-22 Infrastructure Team Meeting</title>
        <link rel="alternate" href="https://blog.rust-lang.org/inside-rust/2019/10/22/infra-team-meeting.html" type="text/html" title="2019-10-22 Infrastructure Team Meeting" />
        <published>2019-10-22T00:00:00Z</published>
        <updated>2019-10-22T00:00:00Z</updated>
        <id>https://blog.rust-lang.org/inside-rust/2019/10/22/infra-team-meeting.html</id>
        <content type="html" xml:base="https://blog.rust-lang.org/inside-rust/2019/10/22/infra-team-meeting.html">&lt;p&gt;Meeting run by pietroalbini. Mintues written by pietroalbini.&lt;br /&gt;
Attending: aidanhs, alexcrichton, kennytm, Mark-Simulacrum, pietroalbini,
shepmaster&lt;br /&gt;
&lt;a href=&quot;https://discordapp.com/channels/442252698964721669/443148319431065610/636247640794857472&quot;&gt;Start of the conversation&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#news-from-the-team&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;news-from-the-team&quot;&gt;&lt;/a&gt;News from the team&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;All the AWS resources related to the bastion are now managed with Terraform.
The documentation on &lt;a href=&quot;https://github.com/rust-lang/infra-team/blob/master/docs/hosts/bastion.md#updating-the-whitelisted-ips&quot;&gt;how to add whitelisted IPs&lt;/a&gt; has
also been updated.&lt;/li&gt;
&lt;li&gt;Crater agents are now deployed with Ansible, and the related AWS resources
are now managed with Terraform. Agents are configured to check for updates
every 5 minutes.&lt;/li&gt;
&lt;li&gt;There was an outage of docs.rs on Sunday night, the postmortem is going to be
published soon on the &amp;quot;Inside Rust&amp;quot; blog and work on the action items from it
is ongoing.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;&lt;a href=&quot;#putting-a-cdn-in-front-of-the-ci-s3-buckets-pietroalbini)&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;putting-a-cdn-in-front-of-the-ci-s3-buckets-pietroalbini)&quot;&gt;&lt;/a&gt;Putting a CDN in front of the CI S3 buckets (pietroalbini)&lt;/h2&gt;
&lt;p&gt;After an audit of our bandwidth usage for the &lt;code&gt;rust-lang-ci-sccache2&lt;/code&gt; and
&lt;code&gt;rust-lang-ci-mirrors&lt;/code&gt; S3 buckets we discovered CI is pulling respectively 8.3
TB and 1.4 TB from them each month. Egress from S3 is pricey (0.09$/GB), while
for us egress from CloudFront is way cheaper (0.04$/month, as across all of our
distributions we transfer out more than 150 TB each month). Putting CloudFront
in front of them is going to save us an estimate of 485$/month.&lt;/p&gt;
&lt;p&gt;Thankfully all the data in those buckets is immutable (mirrors are versioned
and all caches are addressed by hash), so there are not going to be any
problems due to cache invalidation. Sccache doesn‚Äôt support querying a CDN yet
but aidanhs is going to write some pointers and pietroalbini is going to do the
implementation work. The caches CDN is also going to query a new
&lt;code&gt;rust-lang-ci-caches&lt;/code&gt; bucket, to avoid the old naming scheme.&lt;/p&gt;
&lt;p&gt;pietroalbini already setup
&lt;a href=&quot;https://ci-mirrors.rust-lang.org&quot;&gt;ci-mirrors.rust-lang.org&lt;/a&gt;, and is going to
do the implementation work to both create a CDN distribution for caches and
switch the CI to query the CDN.&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#moving-infra-documentation-to-the-forge-pietroalbini)&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;moving-infra-documentation-to-the-forge-pietroalbini)&quot;&gt;&lt;/a&gt;Moving infra documentation to the forge (pietroalbini)&lt;/h2&gt;
&lt;p&gt;There is an effort in the project to centralize all the internal documentation
&lt;a href=&quot;https://forge.rust-lang.org&quot;&gt;on the forge&lt;/a&gt;. pietroalbini proposed to move all
the infra team documentation to it. Everyone agreed, as we find value in having
everything reachable in a single place. aidanhs pointed out that meeting
minutes should not be migrated on the forge.&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#next-meeting-time&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;next-meeting-time&quot;&gt;&lt;/a&gt;Next meeting time&lt;/h2&gt;
&lt;p&gt;Europe will switch DST next week, so the next meeting will be at -1 hours for
europeans and at the same time for everyone else on the team.&lt;/p&gt;
</content>

        <author>
            <name>Pietro Albini</name>
        </author>
    </entry>
    
    <entry>
        <title>Announcing the LLVM ICE-breaker group</title>
        <link rel="alternate" href="https://blog.rust-lang.org/inside-rust/2019/10/22/LLVM-ICE-breakers.html" type="text/html" title="Announcing the LLVM ICE-breaker group" />
        <published>2019-10-22T00:00:00Z</published>
        <updated>2019-10-22T00:00:00Z</updated>
        <id>https://blog.rust-lang.org/inside-rust/2019/10/22/LLVM-ICE-breakers.html</id>
        <content type="html" xml:base="https://blog.rust-lang.org/inside-rust/2019/10/22/LLVM-ICE-breakers.html">&lt;p&gt;Today I'm announcing a new experiment in the compiler team, the &lt;strong&gt;LLVM ICE-breaker group&lt;/strong&gt;. If you're familiar with LLVM and would like to contribute to rustc -- but without taking on a large commitment -- then the LLVM ICE-breaker group might well be for you!&lt;/p&gt;
&lt;h3&gt;&lt;a href=&quot;#what-is-the-llvm-ice-breaker-group&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;what-is-the-llvm-ice-breaker-group&quot;&gt;&lt;/a&gt;What is the LLVM ICE-breaker group?&lt;/h3&gt;
&lt;p&gt;At its heart, the LLVM ICE-breaker group is just a list of people who would like to be notified when we come across LLVM bugs. You can add yourself to this list very easily -- just &lt;a href=&quot;https://rust-lang.github.io/rustc-guide/ice-breaker/about.html#join&quot;&gt;open a PR&lt;/a&gt;! When we come across a suitable bug, we'll write a message that &lt;code&gt;@&lt;/code&gt;-mentions every Github user on that list. If you have some time, maybe you can fix one of them, or at least offer some words of wisdom to help somebody else figure out what's going on.&lt;/p&gt;
&lt;p&gt;There are a few other things associated with the group too, however. For example, we've got a &lt;a href=&quot;https://rust-lang.github.io/rustc-guide/ice-breaker/llvm.html&quot;&gt;guide&lt;/a&gt; that offers some tips for how to fix LLVM-related bugs and may help you get started (particularly if you're not that familiar with rustc).&lt;/p&gt;
&lt;h3&gt;&lt;a href=&quot;#what-kind-of-bugs-are-we-talking-about&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;what-kind-of-bugs-are-we-talking-about&quot;&gt;&lt;/a&gt;What kind of bugs are we talking about?&lt;/h3&gt;
&lt;p&gt;The goal is to identify &amp;quot;self-contained&amp;quot; bugs that are unlikely to require large-scale compiler refactorings or to get entangled in other big projects.&lt;/p&gt;
&lt;h3&gt;&lt;a href=&quot;#who-should-join&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;who-should-join&quot;&gt;&lt;/a&gt;Who should join?&lt;/h3&gt;
&lt;p&gt;This group is a great fit for anyone who is familiar with LLVM and who would like to learn more about Rust or to get more involved in the Rust project. Even if you don't have time to open PRs against rustc, there are many other ways to help:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;identifying open LLVM bugs that we may be running into;&lt;/li&gt;
&lt;li&gt;reducing Rust sources to minimal reducers;&lt;/li&gt;
&lt;li&gt;reducing LLVM IR to minimal problem cases;&lt;/li&gt;
&lt;li&gt;and so forth.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;(For that matter, feel free to join the group even if you're &lt;em&gt;not&lt;/em&gt; all that familiar with LLVM -- no better way to learn!)&lt;/p&gt;
&lt;h3&gt;&lt;a href=&quot;#whats-with-the-name-ice-breaker-anyway?&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;whats-with-the-name-ice-breaker-anyway?&quot;&gt;&lt;/a&gt;What's with the name ICE-breaker anyway?&lt;/h3&gt;
&lt;p&gt;An &amp;quot;ICE&amp;quot; is an &amp;quot;internal compiler error&amp;quot;. It actually refers specifically to the case where the compiler panics (which tends to be an easy sort of bug to fix). In fact, very few LLVM bugs cause real ICEs, but the name was too good to pass up.&lt;/p&gt;
&lt;p&gt;But of course we also hope that these ICE-breaker groups can help people to get more acquainted with hacking on rustc; to &lt;a href=&quot;https://en.wiktionary.org/wiki/break_the_ice&quot;&gt;&amp;quot;break the ice&amp;quot;&lt;/a&gt;, if you will (ha! I kill me).&lt;/p&gt;
&lt;h3&gt;&lt;a href=&quot;#will-there-be-more-ice-breaker-groups&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;will-there-be-more-ice-breaker-groups&quot;&gt;&lt;/a&gt;Will there be more ICE-breaker groups?&lt;/h3&gt;
&lt;p&gt;I certainly hope so! As I mentioned before, this is an experiment, but presuming that it works out well we fully intend to create more ICE-breaker groups.&lt;/p&gt;
&lt;h3&gt;&lt;a href=&quot;#so-how-do-i-sign-up-again&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;so-how-do-i-sign-up-again&quot;&gt;&lt;/a&gt;So how do I sign up again?&lt;/h3&gt;
&lt;p&gt;Easy! Just &lt;a href=&quot;https://rust-lang.github.io/rustc-guide/ice-breaker/about.html#join&quot;&gt;open a PR&lt;/a&gt;!&lt;/p&gt;
</content>

        <author>
            <name>Niko Matsakis</name>
        </author>
    </entry>
    
    <entry>
        <title>2019-10-17 Compiler Team Triage Meeting</title>
        <link rel="alternate" href="https://blog.rust-lang.org/inside-rust/2019/10/21/compiler-team-meeting.html" type="text/html" title="2019-10-17 Compiler Team Triage Meeting" />
        <published>2019-10-21T00:00:00Z</published>
        <updated>2019-10-21T00:00:00Z</updated>
        <id>https://blog.rust-lang.org/inside-rust/2019/10/21/compiler-team-meeting.html</id>
        <content type="html" xml:base="https://blog.rust-lang.org/inside-rust/2019/10/21/compiler-team-meeting.html">&lt;p&gt;The compiler team had our weekly triage meeting on 2019-10-17.
You can find the &lt;a href=&quot;https://rust-lang.github.io/compiler-team/minutes/triage-meeting/2019-10-17/&quot;&gt;minutes&lt;/a&gt; on the &lt;a href=&quot;https://github.com/rust-lang/compiler-team&quot;&gt;compiler-team&lt;/a&gt; repository.
Each week, we have general announcements from the team followed by check-ins from two of the compiler team working groups.&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#announcements&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;announcements&quot;&gt;&lt;/a&gt;Announcements&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Design meeting on &lt;a href=&quot;https://github.com/rust-lang/compiler-team/issues/186&quot;&gt;debuginfo strategy&lt;/a&gt; tomorrow (2019-10-18) on Zulip.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://rust-lang.zulipchat.com/#narrow/stream/131828-t-compiler/topic/design.20meeting.202019-10-18/near/178476377&quot;&gt;Link to full meeting&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The traits working group had a &lt;a href=&quot;https://github.com/rust-lang/wg-traits/tree/master/minutes&quot;&gt;design meeting&lt;/a&gt; yesterday on lazy normalization.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/nikomatsakis&quot;&gt;@nikomatsakis&lt;/a&gt; has been looking into lazy normalization specifically for constants and hopes to have some notes to share soon.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The LLVM ICE-breakers working group is nearly ready to go live.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/spastorino&quot;&gt;@spastorino&lt;/a&gt; has nearly finished interning &lt;code&gt;Place&lt;/code&gt; projections which is an incremental step to MIR 2.0.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/centril&quot;&gt;@centril&lt;/a&gt; is continuing to work on splitting &lt;code&gt;libsyntax&lt;/code&gt; apart which will decrease the amount of code &lt;code&gt;librustc&lt;/code&gt; depends on.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;&lt;a href=&quot;#working-group-sync&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;working-group-sync&quot;&gt;&lt;/a&gt;Working group sync&lt;/h2&gt;
&lt;h3&gt;&lt;a href=&quot;#wg-mir-opt&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;wg-mir-opt&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://rust-lang.github.io/compiler-team/working-groups/mir-opt/&quot;&gt;wg-mir-opt&lt;/a&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/wesleywiser&quot;&gt;@wesleywiser&lt;/a&gt; Moved promoted MIR out of &lt;code&gt;mir::Body&lt;/code&gt; &lt;a href=&quot;https://github.com/rust-lang/rust/pull/63580&quot;&gt;#63580&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/wesleywiser&quot;&gt;@wesleywiser&lt;/a&gt; Reimplemented the &lt;code&gt;ConstProp&lt;/code&gt; optimization pass on top of the existing const eval code &lt;a href=&quot;https://github.com/rust-lang/rust/pull/64419&quot;&gt;#64419&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/spastorino&quot;&gt;@spastorino&lt;/a&gt; Converted &lt;code&gt;mir::Place&lt;/code&gt; to no longer be a recursive data structure &lt;a href=&quot;https://github.com/rust-lang/rust/pull/63420&quot;&gt;#63420&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;There is ongoing work in both const prop and place refactorings.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;We've figured out a plan for &amp;quot;weird&amp;quot; place projections like dereferences (virtual locals).&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&quot;https://rust-lang.zulipchat.com/#narrow/stream/131828-t-compiler/topic/weekly.20meeting.202019-10-17.20.2354818/near/178389131&quot;&gt;Link to full conversation&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;&lt;a href=&quot;#wg-meta&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;wg-meta&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://rust-lang.github.io/compiler-team/working-groups/meta/&quot;&gt;wg-meta&lt;/a&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;The &lt;a href=&quot;https://blog.rust-lang.org/inside-rust/index.html&quot;&gt;Inside Rust&lt;/a&gt; blog has launched.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The &lt;a href=&quot;https://rust-lang.github.io/rustc-guide/ice-breaker/about.html&quot;&gt;ICE-Breaker group&lt;/a&gt; has been formed!&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The &lt;a href=&quot;https://rust-lang.github.io/rustc-guide/ice-breaker/llvm.html&quot;&gt;LLVM ICE-Breaker group&lt;/a&gt; is also being formed.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&quot;https://rust-lang.zulipchat.com/#narrow/stream/131828-t-compiler/topic/weekly.20meeting.202019-10-17.20.2354818/near/178389266&quot;&gt;Link to full conversation&lt;/a&gt;&lt;/p&gt;
</content>

        <author>
            <name>Wesley Wiser</name>
        </author>
    </entry>
    
    <entry>
        <title>Please welcome ecstatic-morse to compiler-contributors</title>
        <link rel="alternate" href="https://blog.rust-lang.org/inside-rust/2019/10/17/ecstatic-morse-for-compiler-contributors.html" type="text/html" title="Please welcome ecstatic-morse to compiler-contributors" />
        <published>2019-10-17T00:00:00Z</published>
        <updated>2019-10-17T00:00:00Z</updated>
        <id>https://blog.rust-lang.org/inside-rust/2019/10/17/ecstatic-morse-for-compiler-contributors.html</id>
        <content type="html" xml:base="https://blog.rust-lang.org/inside-rust/2019/10/17/ecstatic-morse-for-compiler-contributors.html">&lt;p&gt;Please welcome &lt;a href=&quot;https://github.com/ecstatic-morse&quot;&gt;@ecstatic-morse&lt;/a&gt; to the &lt;a href=&quot;https://rust-lang.github.io/rfcs/2689-compiler-team-contributors.html&quot;&gt;compiler contributors&lt;/a&gt; group!
They're working to make compile-time evaluation more expressive by
enabling &lt;code&gt;if&lt;/code&gt;, &lt;code&gt;match&lt;/code&gt; and other control flow in constants. As one of
their first major contributions, they implemented a dataflow analysis
to validate the bodies of &lt;code&gt;const&lt;/code&gt;s and &lt;code&gt;const fn&lt;/code&gt;s
(&lt;a href=&quot;https://github.com/rust-lang/rust/pull/64470&quot;&gt;rust-lang/rust#64470&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;Congratulations &lt;a href=&quot;https://github.com/ecstatic-morse&quot;&gt;@ecstatic-morse&lt;/a&gt;, and thanks!&lt;/p&gt;
</content>

        <author>
            <name>Niko Matsakis</name>
        </author>
    </entry>
    
    <entry>
        <title>2019-10-10 Infrastructure Team Meeting</title>
        <link rel="alternate" href="https://blog.rust-lang.org/inside-rust/2019/10/15/infra-team-meeting.html" type="text/html" title="2019-10-10 Infrastructure Team Meeting" />
        <published>2019-10-15T00:00:00Z</published>
        <updated>2019-10-15T00:00:00Z</updated>
        <id>https://blog.rust-lang.org/inside-rust/2019/10/15/infra-team-meeting.html</id>
        <content type="html" xml:base="https://blog.rust-lang.org/inside-rust/2019/10/15/infra-team-meeting.html">&lt;p&gt;Meeting run by kennytm. Minutes written by pietroalbini.&lt;br /&gt;
Attending: alexcrichton, kennytm, Mark-Simulacrum, pietroalbini, sgrif,
shepmaster&lt;br /&gt;
&lt;a href=&quot;https://discordapp.com/channels/442252698964721669/443148319431065610/633710764762464285&quot;&gt;Start of the conversation&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#publishing-the-meeting-minutes-pietroalbini)&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;publishing-the-meeting-minutes-pietroalbini)&quot;&gt;&lt;/a&gt;Publishing the meeting minutes (pietroalbini)&lt;/h2&gt;
&lt;p&gt;The infrastructure team recently started keeping minutes of the meetings (these
ones!), recording everything we decided and what the rationale of the decision
was. The original minutes are stored in a private Paper document, as they also
contain minutes of the private parts of the meetings.&lt;/p&gt;
&lt;p&gt;pietroalbini proposed to store a public version of the minutes (with the
private parts removed) on the
&lt;a href=&quot;https://github.com/rust-lang/infra-team&quot;&gt;infra-team&lt;/a&gt; repository, and to
cross-post them on the &lt;a href=&quot;https://blog.rust-lang.org/inside-rust&quot;&gt;‚ÄúInside Rust‚Äù&lt;/a&gt;
blog. The rest of the team agreed on this. pietroalbini also volunteered to
make the work of writing the minutes and publishing them.&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#binary-signing-and-the-signpath-offer-pietroalbini)&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;binary-signing-and-the-signpath-offer-pietroalbini)&quot;&gt;&lt;/a&gt;Binary signing and the SignPath offer (pietroalbini)&lt;/h2&gt;
&lt;p&gt;A few weeks ago the team received an email from SignPath offering code signing
certificates and infrastructure to the Rust project. The main concern team
members had was the lack of time to implement the changes on our end, as
everyone is busy with other tasks. Everyone agreed to revisit the topic and
their offer once someone inside the team has time to drive the implementation
effort.&lt;/p&gt;
</content>

        <author>
            <name>Pietro Albini</name>
        </author>
    </entry>
    
    <entry>
        <title>2019-10-10 Compiler Team Triage Meeting</title>
        <link rel="alternate" href="https://blog.rust-lang.org/inside-rust/2019/10/15/compiler-team-meeting.html" type="text/html" title="2019-10-10 Compiler Team Triage Meeting" />
        <published>2019-10-15T00:00:00Z</published>
        <updated>2019-10-15T00:00:00Z</updated>
        <id>https://blog.rust-lang.org/inside-rust/2019/10/15/compiler-team-meeting.html</id>
        <content type="html" xml:base="https://blog.rust-lang.org/inside-rust/2019/10/15/compiler-team-meeting.html">&lt;p&gt;The compiler team had our weekly triage meeting on 2019-10-10.
You can find the &lt;a href=&quot;https://rust-lang.github.io/compiler-team/minutes/triage-meeting/2019-10-10/&quot;&gt;minutes&lt;/a&gt; on the &lt;a href=&quot;https://github.com/rust-lang/compiler-team&quot;&gt;compiler-team&lt;/a&gt; repository.
Each week, we have general announcements from the team followed by check-ins from two of the compiler team working groups.&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#announcements&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;announcements&quot;&gt;&lt;/a&gt;Announcements&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/centril&quot;&gt;@centril&lt;/a&gt; is splitting &lt;code&gt;libsyntax&lt;/code&gt; into data and logic parts which will decrease the amount of code &lt;code&gt;librustc&lt;/code&gt; depends on.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/nagisa&quot;&gt;@nagisa&lt;/a&gt; is working on a cross-platform version of stacker which will allow us to avoid stack overflows in rustc.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;There is a compiler team &lt;a href=&quot;https://rust-lang.github.io/compiler-team/minutes/design-meeting/2019-10-11-DepGraph-persistence-PR62038/&quot;&gt;design meeting&lt;/a&gt; scheduled for tomorrow (2019-10-11) to discuss some of &lt;a href=&quot;https://github.com/zoxc&quot;&gt;@Zoxc&lt;/a&gt;'s PRs.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/pnkfelix&quot;&gt;@pnkfelix&lt;/a&gt; is revising the code that handles structural match checking.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/nikomatsakis&quot;&gt;@nikomatsakis&lt;/a&gt; has a PR (&lt;a href=&quot;https://github.com/rust-lang/rust/issues/65232&quot;&gt;#65232&lt;/a&gt;) up which helps us get closer to lazy normalization.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;wg-traits&lt;/code&gt; is going to start holding a weekly &amp;quot;office hours&amp;quot; video call to help answer questions and teach people about trait system internals.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;&lt;a href=&quot;#working-group-sync&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;working-group-sync&quot;&gt;&lt;/a&gt;Working group sync&lt;/h2&gt;
&lt;h3&gt;&lt;a href=&quot;#wg-learning&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;wg-learning&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://rust-lang.github.io/compiler-team/working-groups/learning/&quot;&gt;wg-learning&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;wg-learning&lt;/code&gt; aims to make the compiler easier to learn by ensuring that rustc-guide and api docs are ‚Äúcomplete‚Äù.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;wg-learning&lt;/code&gt; has been working on transcribing videos from the &lt;a href=&quot;https://www.youtube.com/watch?v=elBxMRSNYr4&amp;list=PL85XCvVPmGQhOL-J2Ng7qlPvDVOwYpGTN&quot;&gt;compiler lecture series&lt;/a&gt; into &lt;a href=&quot;https://rust-lang.github.io/rustc-guide/&quot;&gt;rustc-guide&lt;/a&gt; chapters.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Originally, individuals were assigned one or lectures to complete but that hasn't worked very well.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Recently, they're trying to work on one video at a time as a team with much better results.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;There's &lt;a href=&quot;https://paper.dropbox.com/doc/Ty-lecture-summary--Almbjo_id6n8CKrOHlsTMG2dAg-4jFj9bVOLlW7uhIOWHITX&quot;&gt;a PR&lt;/a&gt; open for a new chapter based on the &lt;code&gt;ty&lt;/code&gt; lecture.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&quot;https://rust-lang.zulipchat.com/#narrow/stream/131828-t-compiler/topic/weekly.20meeting.202019-10-10.20.2354818/near/177816515&quot;&gt;Link to full discussion&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;&lt;a href=&quot;#wg-llvm&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;wg-llvm&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://rust-lang.github.io/compiler-team/working-groups/llvm/&quot;&gt;wg-llvm&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;wg-llvm&lt;/code&gt; encompasses work in LLVM upstream fixing the issues and implementing features that matter to Rust.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;rustc has upgraded to the LLVM 9 release;
&lt;ul&gt;
&lt;li&gt;Which allows us to replace some the emscripten stuff with LLVM‚Äôs toolchain.&lt;/li&gt;
&lt;li&gt;As part of these upgrades we will likely end up dropping support for the super old LLVM 6, which in turn allows us to stop building the unnecessary Go &amp;amp; OCaml bindings to LLVM, which in turn helps rustc build times slightly.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;People are also working on enabling use of the new pass manager, which might give us some tangible code quality improvements over the status quo.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&quot;https://rust-lang.zulipchat.com/#narrow/stream/131828-t-compiler/topic/weekly.20meeting.202019-10-10.20.2354818/near/177817116&quot;&gt;Link to full discussion&lt;/a&gt;&lt;/p&gt;
</content>

        <author>
            <name>Wesley Wiser</name>
        </author>
    </entry>
    
    <entry>
        <title>2019-10-10 Lang Team Triage Meeting</title>
        <link rel="alternate" href="https://blog.rust-lang.org/inside-rust/2019/10/11/Lang-Team-Meeting.html" type="text/html" title="2019-10-10 Lang Team Triage Meeting" />
        <published>2019-10-11T00:00:00Z</published>
        <updated>2019-10-11T00:00:00Z</updated>
        <id>https://blog.rust-lang.org/inside-rust/2019/10/11/Lang-Team-Meeting.html</id>
        <content type="html" xml:base="https://blog.rust-lang.org/inside-rust/2019/10/11/Lang-Team-Meeting.html">&lt;p&gt;We had our &lt;a href=&quot;https://github.com/rust-lang/lang-team/#meeting-calendara&quot;&gt;weekly triage meeting&lt;/a&gt; on 2019-10-10. You can find the
&lt;a href=&quot;https://github.com/rust-lang/lang-team/blob/master/minutes/2019-10-10.md&quot;&gt;minutes&lt;/a&gt; on the &lt;a href=&quot;https://github.com/rust-lang/lang-team/&quot;&gt;lang-team&lt;/a&gt; repository; there is also a &lt;a href=&quot;https://youtu.be/QvE9-zce5_4&quot;&gt;video
recording&lt;/a&gt; on YouTube. This week we had a number of folks who have
been working on const evaluation in attendance, which gave us an
opportunity to dive into some of the complexities involved there. We
also discussed how to make the const evaluation effort into a
&amp;quot;shepherded project&amp;quot;, a concept that we are still actively developing
(see my blog post on &lt;a href=&quot;http://smallcultfollowing.com/babysteps/blog/2019/09/11/aic-shepherds-3-0/&quot;&gt;Shepherding 3.0&lt;/a&gt; for the general idea).&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#other-updates-on-shepherded-items&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;other-updates-on-shepherded-items&quot;&gt;&lt;/a&gt;Other updates on shepherded items&lt;/h2&gt;
&lt;p&gt;This is our current list of &amp;quot;shepherded items&amp;quot;, which are things we
are tracking week to week. We're still evolving the shepherding
system. Hopefully we'll soon have links for all of these to a good,
representative place that explains the overall status and roadmap. All
in good time.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/nikomatsakis/project-ffi-unwind&quot;&gt;unwind-ffi&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;created a &lt;a href=&quot;http://smallcultfollowing.com/babysteps/blog/2019/09/11/aic-shepherds-3-0/&quot;&gt;zulip&lt;/a&gt; stream (&lt;code&gt;#wg-ffi-unwind&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;preparing an RFC that creates the group official and lays out the roadmap&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&amp;quot;object safety&amp;quot; group (e.g., &lt;a href=&quot;http://smallcultfollowing.com/babysteps/blog/2019/09/11/aic-shepherds-3-0/&quot;&gt;#57893&lt;/a&gt;)
&lt;ul&gt;
&lt;li&gt;no major updates, still iterating on the &amp;quot;in progress&amp;quot; branch&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;re-rebalance coherence
&lt;ul&gt;
&lt;li&gt;we have a spreadsheet mapping out all the possible tests&lt;/li&gt;
&lt;li&gt;we'll fill out the matrix, but probably ready to stabilize üéâ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;stabilize proc-macros generating macro-rules items
&lt;ul&gt;
&lt;li&gt;waiting on a report from pnkfelix&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;grammar working group
&lt;ul&gt;
&lt;li&gt;no updates&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</content>

        <author>
            <name>Niko Matsakis</name>
        </author>
    </entry>
    
    <entry>
        <title>Improving async-await's &quot;Future is not Send&quot; diagnostic</title>
        <link rel="alternate" href="https://blog.rust-lang.org/inside-rust/2019/10/11/AsyncAwait-Not-Send-Error-Improvements.html" type="text/html" title="Improving async-await's &quot;Future is not Send&quot; diagnostic" />
        <published>2019-10-11T00:00:00Z</published>
        <updated>2019-10-11T00:00:00Z</updated>
        <id>https://blog.rust-lang.org/inside-rust/2019/10/11/AsyncAwait-Not-Send-Error-Improvements.html</id>
        <content type="html" xml:base="https://blog.rust-lang.org/inside-rust/2019/10/11/AsyncAwait-Not-Send-Error-Improvements.html">&lt;p&gt;Async-await is due to hit stable in the 1.39 release (only a month away!), and as announced in the
&lt;a href=&quot;https://blog.rust-lang.org/inside-rust/2019/10/07/AsyncAwait-WG-Focus-Issues.html&quot;&gt;&amp;quot;Async Foundations Update: Time for polish!&amp;quot;&lt;/a&gt; post last month, the Async
Foundations WG has shifted its focus to polish. This post will highlight one aspect of that
focus, diagnostic improvements, and in particular, the improvements that the working group has
been making to the once-unhelpful &amp;quot;future is not send&amp;quot; diagnostic.&lt;/p&gt;
&lt;h1&gt;&lt;a href=&quot;#why-doesnt-my-future-implement-send?&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;why-doesnt-my-future-implement-send?&quot;&gt;&lt;/a&gt;Why doesn't my future implement &lt;code&gt;Send&lt;/code&gt;?&lt;/h1&gt;
&lt;p&gt;One of the major places where async-await should be a pleasure to use is in multithreaded contexts,
where having a future that can be sent to other threads is desirable. This might look something
like the following (for brevity, there aren't any threads here, just a requirement that the
future implement &lt;code&gt;std::marker::Send&lt;/code&gt;):&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-rust&quot;&gt;use std::sync::{Mutex, MutexGuard};

fn is_send&amp;lt;T: Send&amp;gt;(t: T) { }

async fn foo() {
    bar(&amp;amp;Mutex::new(22)).await
}

async fn bar(x: &amp;amp;Mutex&amp;lt;u32&amp;gt;) {
    let g = x.lock().unwrap();
    baz().await
}

async fn baz() { }

fn main() {
    is_send(foo());
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;When we try to compile this, we'll get an unwieldly and hard-to-follow diagnostic:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;error[E0277]: `std::sync::MutexGuard&amp;lt;'_, u32&amp;gt;` cannot be sent between threads safely
  --&amp;gt; src/main.rs:23:5
   |
23 |     is_send(foo());
   |     ^^^^^^^ `std::sync::MutexGuard&amp;lt;'_, u32&amp;gt;` cannot be sent between threads safely
   |
   = help: within `impl std::future::Future`, the trait `std::marker::Send` is not implemented for `std::sync::MutexGuard&amp;lt;'_, u32&amp;gt;`
   = note: required because it appears within the type `for&amp;lt;'r, 's&amp;gt; {&amp;amp;'r std::sync::Mutex&amp;lt;u32&amp;gt;, std::sync::MutexGuard&amp;lt;'s, u32&amp;gt;, impl std::future::Future, ()}`
   = note: required because it appears within the type `[static generator@src/main.rs:13:30: 16:2 x:&amp;amp;std::sync::Mutex&amp;lt;u32&amp;gt; for&amp;lt;'r, 's&amp;gt; {&amp;amp;'r std::sync::Mutex&amp;lt;u32&amp;gt;, std::sync::MutexGuard&amp;lt;'s, u32&amp;gt;, impl std::future::Future, ()}]`
   = note: required because it appears within the type `std::future::GenFuture&amp;lt;[static generator@src/main.rs:13:30: 16:2 x:&amp;amp;std::sync::Mutex&amp;lt;u32&amp;gt; for&amp;lt;'r, 's&amp;gt; {&amp;amp;'r std::sync::Mutex&amp;lt;u32&amp;gt;, std::sync::MutexGuard&amp;lt;'s, u32&amp;gt;, impl std::future::Future, ()}]&amp;gt;`
   = note: required because it appears within the type `impl std::future::Future`
   = note: required because it appears within the type `impl std::future::Future`
   = note: required because it appears within the type `for&amp;lt;'r&amp;gt; {impl std::future::Future, ()}`
   = note: required because it appears within the type `[static generator@src/main.rs:9:16: 11:2 for&amp;lt;'r&amp;gt; {impl std::future::Future, ()}]`
   = note: required because it appears within the type `std::future::GenFuture&amp;lt;[static generator@src/main.rs:9:16: 11:2 for&amp;lt;'r&amp;gt; {impl std::future::Future, ()}]&amp;gt;`
   = note: required because it appears within the type `impl std::future::Future`
   = note: required because it appears within the type `impl std::future::Future`
note: required by `is_send`
  --&amp;gt; src/main.rs:5:1
   |
5  | fn is_send&amp;lt;T: Send&amp;gt;(t: T) {
   | ^^^^^^^^^^^^^^^^^^^^^^^^^
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;That's.. not great. Let's break down what's happening and understand what this error is trying to
tell us.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-rust&quot;&gt;fn main() {
    is_send(foo());
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In &lt;code&gt;main&lt;/code&gt;, we are calling &lt;code&gt;foo&lt;/code&gt; and passing the return value to &lt;code&gt;is_send&lt;/code&gt;. &lt;code&gt;foo&lt;/code&gt; is an &lt;code&gt;async fn&lt;/code&gt;,
so it doesn't return &lt;code&gt;()&lt;/code&gt; (what you might expect for a function with no return type specified).
Instead, it returns &lt;code&gt;impl std::future::Future&amp;lt;Output = ()&amp;gt;&lt;/code&gt;, some unnamed type that implements
&lt;code&gt;std::future::Future&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-rust&quot;&gt;async fn foo() {
    bar(&amp;amp;Mutex::new(22)).await
}

// becomes...

fn foo() -&amp;gt; impl std::future::Future&amp;lt;Output = ()&amp;gt; {
    async move {
        bar(&amp;amp;Mutex::new(22)).await
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If you want to learn more about the transformations that happen with async-await, consider
reading the &lt;a href=&quot;https://rust-lang.github.io/async-book/01_getting_started/04_async_await_primer.html&quot;&gt;&lt;code&gt;async&lt;/code&gt;/&lt;code&gt;.await&lt;/code&gt; primer chapter of the async book&lt;/a&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-rust&quot;&gt;fn is_send&amp;lt;T: Send&amp;gt;(t: T) { }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It looks like the error we're getting is because the future returned by &lt;code&gt;foo&lt;/code&gt; doesn't satisfy
the &lt;code&gt;T: Send&lt;/code&gt; bound of &lt;code&gt;is_send&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#how-are-async-functions-implemented&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;how-are-async-functions-implemented&quot;&gt;&lt;/a&gt;How are async functions implemented?&lt;/h2&gt;
&lt;p&gt;To explain why our future doesn't implement &lt;code&gt;Send&lt;/code&gt;, we first need to understand a little bit more
about what async-await is doing under the hood. rustc implements &lt;code&gt;async fn&lt;/code&gt;s using generators,
an unstable language feature for resumable functions like the co-routines you might be familiar
with from other languages. Generators are laid out like enums with variants containing all of the
variables that are used across await points (which desugar to generator yields):&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-rust&quot;&gt;async fn bar(x: &amp;amp;Mutex&amp;lt;u32&amp;gt;) {
    let g = x.lock().unwrap();
    baz().await // &amp;lt;- await point (suspend #0), `g` and `x` are in use before await point
} // &amp;lt;- `g` and `x` dropped here, after await point
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&quot;language-rust&quot;&gt;enum BarGenerator {
    // `bar`'s parameters.
    Unresumed { x: &amp;amp;Mutex&amp;lt;u32&amp;gt; },

    Suspend0 {
        // Future returned by `baz`, which is being polled.
        baz_future: BazGenerator,

        // Locals that are used across the await point.
        x: &amp;amp;Mutex&amp;lt;u32&amp;gt;,
        g: MutexGuard&amp;lt;'_, u32&amp;gt;,
    },

    Returned { value: () }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If you want to learn more about the &lt;code&gt;async fn&lt;/code&gt; implementation details, then Tyler Mandry has
written &lt;a href=&quot;https://tmandry.gitlab.io/blog/posts/optimizing-await-1/&quot;&gt;an excellent blog post&lt;/a&gt; diving into their work here in more depth which is
definitely worth a read.&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#so-why-doesn't-my-future-implement-send?&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;so-why-doesn't-my-future-implement-send?&quot;&gt;&lt;/a&gt;So, why doesn't my future implement &lt;code&gt;Send&lt;/code&gt;?&lt;/h2&gt;
&lt;p&gt;We now know that an &lt;code&gt;async fn&lt;/code&gt; is represented like an enum behind-the-scenes. In synchronous Rust,
you'll be used to your types automatically implementing &lt;code&gt;Send&lt;/code&gt; when the
&lt;a href=&quot;https://doc.rust-lang.org/std/marker/trait.Send.html&quot;&gt;compiler determines it's appropriate&lt;/a&gt; - typically when all of the fields of your type
also implement &lt;code&gt;Send&lt;/code&gt;. It follows that the enum-like that represents our &lt;code&gt;async fn&lt;/code&gt; would
implement &lt;code&gt;Send&lt;/code&gt; if all of the types in it do.&lt;/p&gt;
&lt;p&gt;In other words, a future is safe to send across threads if all of the types that are held across
&lt;code&gt;.await&lt;/code&gt; points implement &lt;code&gt;Send&lt;/code&gt;. This behaviour is useful because it lets us write generic code
that interoperates smoothly with async-await, but without diagnostic support we get confusing error
messages.&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#well-which-type-is-the-problem-in-the-example?&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;well-which-type-is-the-problem-in-the-example?&quot;&gt;&lt;/a&gt;Well, which type is the problem in the example?&lt;/h2&gt;
&lt;p&gt;Returning to our example, the future must be holding a type across an &lt;code&gt;.await&lt;/code&gt; point that doesn't
implement &lt;code&gt;Send&lt;/code&gt;, but where? This is the primary question that the diagnostic improvement aims to
help answer. Let's start by looking at &lt;code&gt;foo&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-rust&quot;&gt;async fn foo() {
    bar(&amp;amp;Mutex::new(22)).await
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;foo&lt;/code&gt; invokes &lt;code&gt;bar&lt;/code&gt;, passing a reference to a &lt;code&gt;std::sync::Mutex&lt;/code&gt; and getting a future back, before
&lt;code&gt;await&lt;/code&gt;ing it.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-rust&quot;&gt;async fn bar(x: &amp;amp;Mutex&amp;lt;u32&amp;gt;) {
    let g: MutexGuard&amp;lt;u32&amp;gt; = x.lock().unwrap();
    baz().await
} // &amp;lt;- `g` is dropped here
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;bar&lt;/code&gt; locks the mutex before &lt;code&gt;await&lt;/code&gt;ing &lt;code&gt;baz&lt;/code&gt;. &lt;code&gt;std::sync::MutexGuard&amp;lt;u32&amp;gt;&lt;/code&gt; does not implement
&lt;code&gt;Send&lt;/code&gt; and lives across the &lt;code&gt;baz().await&lt;/code&gt; point (because &lt;code&gt;g&lt;/code&gt; is dropped at the end of the scope)
which causes the entire future not to implement &lt;code&gt;Send&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;That wasn't obvious from the error: we had to know that futures might implement &lt;code&gt;Send&lt;/code&gt; depending
on the types they capture &lt;em&gt;and&lt;/em&gt; find the type which lives across an await point ourselves.&lt;/p&gt;
&lt;p&gt;Fortunately, the Async Foundations WG has been working to improve this error, and
&lt;a href=&quot;https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=7e80a8bc151df8817e0983e55bf2667a&quot;&gt;in nightly&lt;/a&gt;, we see the following diagnostic instead:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;error[E0277]: `std::sync::MutexGuard&amp;lt;'_, u32&amp;gt;` cannot be sent between threads safely
  --&amp;gt; src/main.rs:23:5
   |
5  | fn is_send&amp;lt;T: Send&amp;gt;(t: T) {
   |    -------    ---- required by this bound in `is_send`
...
23 |     is_send(foo());
   |     ^^^^^^^ `std::sync::MutexGuard&amp;lt;'_, u32&amp;gt;` cannot be sent between threads safely
   |
   = help: within `impl std::future::Future`, the trait `std::marker::Send` is not implemented for `std::sync::MutexGuard&amp;lt;'_, u32&amp;gt;`
note: future does not implement `std::marker::Send` as this value is used across an await
  --&amp;gt; src/main.rs:15:3
   |
14 |   let g = x.lock().unwrap();
   |       - has type `std::sync::MutexGuard&amp;lt;'_, u32&amp;gt;`
15 |   baz().await;
   |   ^^^^^^^^^^^ await occurs here, with `g` maybe used later
16 | }
   | - `g` is later dropped here
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Much better!&lt;/p&gt;
&lt;h1&gt;&lt;a href=&quot;#how-does-it-work&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;how-does-it-work&quot;&gt;&lt;/a&gt;How does it work?&lt;/h1&gt;
&lt;p&gt;When rustc's trait system determines that a trait wasn't implemented, in this case
&lt;code&gt;std::marker::Send&lt;/code&gt;, it emits this error. The trait system produces a chain of &amp;quot;obligations&amp;quot;.
Obligations are types which denote where a bound (e.g &lt;code&gt;T: Send&lt;/code&gt; in &lt;code&gt;is_send&lt;/code&gt;) originated,
or where a bound was propagated.&lt;/p&gt;
&lt;p&gt;To improve this diagnostic, the chain of obligations is now treated like a stack frame, where
each &amp;quot;frame&amp;quot; of obligations represents each function's contribution to the error. Let's make
that more concrete with a very rough approximation:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-rust&quot;&gt;Obligation {
    kind: DerivedObligation(/* generator that captured `g` */),
    source: /* `Span` type pointing at `bar`'s location in user code */,
    parent: Some(Obligation {
        kind: DerivedObligation(/* generator calling `bar` */),
        source: /* `Span` type pointing at `foo`'s location in user code */,
        parent: Some(Obligation {
            kind: ItemObligation(/* type representing `std::marker::Send` */),
            source: /* `Span` type pointing at `is_send`'s location in user code */,
            cause: None,
        }),
    }),
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The compiler matches against the chain expecting an &lt;code&gt;ItemObligation&lt;/code&gt; and some &lt;code&gt;DerivedObligation&lt;/code&gt;s
containing generators, which identifies the error we want to improve. Using information from these
obligations, rustc can construct the specialized error shown above - if you'd like to see what the
actual implementation looks like, check out PR &lt;a href=&quot;https://github.com/rust-lang/rust/pull/64895&quot;&gt;#64895&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;If you're interested in improving diagnostics like this, or even just fixing bugs, consider
contributing to the compiler! There are many working groups to join and resources to help you get
started (like the &lt;a href=&quot;https://rust-lang.github.io/rustc-guide&quot;&gt;rustc guide&lt;/a&gt; or the &lt;a href=&quot;https://rust-lang.github.io/compiler-team&quot;&gt;compiler team documentation&lt;/a&gt;).&lt;/p&gt;
&lt;h1&gt;&lt;a href=&quot;#whats-next?&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot; id=&quot;whats-next?&quot;&gt;&lt;/a&gt;What's next?&lt;/h1&gt;
&lt;p&gt;More improvements to this diagnostic are planned and being worked on, so that it is applicable in
more cases, and has specialized messages for &lt;code&gt;Send&lt;/code&gt; and &lt;code&gt;Sync&lt;/code&gt;, like below:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;error[E0277]: future cannot be sent between threads safely
  --&amp;gt; src/main.rs:23:5
   |
5  | fn is_send&amp;lt;T: Send&amp;gt;(t: T) {
   |    -------    ---- required by this bound in `is_send`
...
23 |     is_send(foo());
   |     ^^^^^^^ future returned by `foo` is not `Send`
   |
   = help:  future is not `Send` as this value is used across an await
note: future does not implement `std::marker::Send` as this value is used across an await
  --&amp;gt; src/main.rs:15:3
   |
14 |   let g = x.lock().unwrap();
   |       - has type `std::sync::MutexGuard&amp;lt;'_, u32&amp;gt;`
15 |   baz().await;
   |   ^^^^^^^^^^^ await occurs here, with `g` maybe used later
16 | }
   | - `g` is later dropped here
&lt;/code&gt;&lt;/pre&gt;
</content>

        <author>
            <name>David Wood</name>
        </author>
    </entry>
    
</feed>
